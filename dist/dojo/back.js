/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["./_base/config","./_base/lang","./sniff","./dom","./dom-construct","./_base/window","require"],function(o,n,r,t,e,a,i){var l={};r("extend-dojo")&&n.setObject("dojo.back",l);var d=l.getHash=function(){var o=window.location.hash;return"#"==o.charAt(0)&&(o=o.substring(1)),r("mozilla")?o:decodeURIComponent(o)},s=l.setHash=function(o){o||(o=""),window.location.hash=encodeURIComponent(o),history.length},u="undefined"!=typeof window?window.location.href:"",h="undefined"!=typeof window?d():"",f=null,c=null,w=null,g=null,m=[],b=[],k=!1,y=!1;function p(){var o=b.pop();if(o){var n=b[b.length-1];n||0!=b.length||(n=f),n&&(n.kwArgs.back?n.kwArgs.back():n.kwArgs.backButton?n.kwArgs.backButton():n.kwArgs.handle&&n.kwArgs.handle("back")),m.push(o)}}function v(){var o=m.pop();o&&(o.kwArgs.forward?o.kwArgs.forward():o.kwArgs.forwardButton?o.kwArgs.forwardButton():o.kwArgs.handle&&o.kwArgs.handle("forward"),b.push(o))}function j(o,n,r){return{url:o,kwArgs:n,urlHash:r}}function A(o){var n=o.split("?");return n.length<2?null:n[1]}function H(){var n=(o.dojoIframeHistoryUrl||i.toUrl("./resources/iframe_history.html"))+"?"+(new Date).getTime();return k=!0,g&&(r("webkit")?g.location=n:window.frames[g.name].location=n),n}function _(){if(!y){var o=b.length,n=d();if((n===h||window.location.href==u)&&1==o)return void p();if(m.length>0&&m[m.length-1].urlHash===n)return void v();o>=2&&b[o-2]&&b[o-2].urlHash===n&&p()}}return l.goBack=p,l.goForward=v,l.init=function(){if(!t.byId("dj_history")){var n=o.dojoIframeHistoryUrl||i.toUrl("./resources/iframe_history.html");o.afterOnLoad?console.error("dojo/back::init() must be called before the DOM has loaded. Include dojo/back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+n+'"></iframe>')}},l.setInitialState=function(o){f=j(u,o,h)},l.addToHistory=function(n){m=[];var t=null,i=null;if(g||(o.useXDomain&&!o.dojoIframeHistoryUrl&&console.warn("dojo/back: When using cross-domain Dojo builds, please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl to the path on your domain to iframe_history.html"),g=window.frames.dj_history),w||(w=e.create("a",{style:{display:"none"}},a.body())),n.changeUrl){if(t=""+(!0!==n.changeUrl?n.changeUrl:(new Date).getTime()),0==b.length&&f.urlHash==t)return void(f=j(i,n,t));if(b.length>0&&b[b.length-1].urlHash==t)return void(b[b.length-1]=j(i,n,t));if(y=!0,setTimeout(function(){s(t),y=!1},1),w.href=t,r("ie")){i=H();var l=n.back||n.backButton||n.handle,u=function(o){""!=d()&&setTimeout(function(){s(t)},1),l.apply(this,[o])};n.back?n.back=u:n.backButton?n.backButton=u:n.handle&&(n.handle=u);var h=n.forward||n.forwardButton||n.handle,k=function(o){""!=d()&&s(t),h&&h.apply(this,[o])};n.forward?n.forward=k:n.forwardButton?n.forwardButton=k:n.handle&&(n.handle=k)}else r("ie")||c||(c=setInterval(_,200))}else i=H();b.push(j(i,n,t))},l._iframeLoaded=function(o,n){var r=A(n.href);null!=r?k?k=!1:b.length>=2&&r==A(b[b.length-2].url)?p():m.length>0&&r==A(m[m.length-1].url)&&v():1==b.length&&p()},l});
//# sourceMappingURL=sourcemaps/back.js.map
