/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["./_base/config","./_base/lang","./sniff","./dom","./dom-construct","./_base/window","require"],function(o,n,r,t,e,a,require){var i={};r("extend-dojo")&&n.setObject("dojo.back",i);var l=i.getHash=function(){var o=window.location.hash;return"#"==o.charAt(0)&&(o=o.substring(1)),r("mozilla")?o:decodeURIComponent(o)},d=i.setHash=function(o){o||(o=""),window.location.hash=encodeURIComponent(o),history.length},s="undefined"!=typeof window?window.location.href:"",u="undefined"!=typeof window?l():"",h=null,f=null,c=null,w=null,g=[],m=[],b=!1,k=!1;function y(){var o=m.pop();if(o){var n=m[m.length-1];n||0!=m.length||(n=h),n&&(n.kwArgs.back?n.kwArgs.back():n.kwArgs.backButton?n.kwArgs.backButton():n.kwArgs.handle&&n.kwArgs.handle("back")),g.push(o)}}function p(){var o=g.pop();o&&(o.kwArgs.forward?o.kwArgs.forward():o.kwArgs.forwardButton?o.kwArgs.forwardButton():o.kwArgs.handle&&o.kwArgs.handle("forward"),m.push(o))}function v(o,n,r){return{url:o,kwArgs:n,urlHash:r}}function j(o){var n=o.split("?");return n.length<2?null:n[1]}function A(){var n=(o.dojoIframeHistoryUrl||require.toUrl("./resources/iframe_history.html"))+"?"+(new Date).getTime();return b=!0,w&&(r("webkit")?w.location=n:window.frames[w.name].location=n),n}function H(){if(!k){var o=m.length,n=l();if((n===u||window.location.href==s)&&1==o)return void y();if(g.length>0&&g[g.length-1].urlHash===n)return void p();o>=2&&m[o-2]&&m[o-2].urlHash===n&&y()}}return i.goBack=y,i.goForward=p,i.init=function(){if(!t.byId("dj_history")){var n=o.dojoIframeHistoryUrl||require.toUrl("./resources/iframe_history.html");o.afterOnLoad?console.error("dojo/back::init() must be called before the DOM has loaded. Include dojo/back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+n+'"></iframe>')}},i.setInitialState=function(o){h=v(s,o,u)},i.addToHistory=function(n){g=[];var t=null,i=null;if(w||(o.useXDomain&&!o.dojoIframeHistoryUrl&&console.warn("dojo/back: When using cross-domain Dojo builds, please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl to the path on your domain to iframe_history.html"),w=window.frames.dj_history),c||(c=e.create("a",{style:{display:"none"}},a.body())),n.changeUrl){if(t=""+(!0!==n.changeUrl?n.changeUrl:(new Date).getTime()),0==m.length&&h.urlHash==t)return void(h=v(i,n,t));if(m.length>0&&m[m.length-1].urlHash==t)return void(m[m.length-1]=v(i,n,t));if(k=!0,setTimeout(function(){d(t),k=!1},1),c.href=t,r("ie")){i=A();var s=n.back||n.backButton||n.handle,u=function(o){""!=l()&&setTimeout(function(){d(t)},1),s.apply(this,[o])};n.back?n.back=u:n.backButton?n.backButton=u:n.handle&&(n.handle=u);var b=n.forward||n.forwardButton||n.handle,y=function(o){""!=l()&&d(t),b&&b.apply(this,[o])};n.forward?n.forward=y:n.forwardButton?n.forwardButton=y:n.handle&&(n.handle=y)}else r("ie")||f||(f=setInterval(H,200))}else i=A();m.push(v(i,n,t))},i._iframeLoaded=function(o,n){var r=j(n.href);null!=r?b?b=!1:m.length>=2&&r==j(m[m.length-2].url)?y():g.length>0&&r==j(g[g.length-1].url)&&p():1==m.length&&y()},i});
//# sourceMappingURL=sourcemaps/back.js.map
