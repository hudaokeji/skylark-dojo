/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(e,t,o,r,n,a,i,l,d,u,s,c){var m=e.id.replace(/[\/\.\-]/g,"_"),f=m+"_onload";function h(e){return!this.isFulfilled()}function _(e){return!!this._finished}function g(e,t){if(!t)try{var o=e.options,r=b.doc(b._frame),i=o.handleAs;if("html"!==i){if("xml"===i)if("html"===r.documentElement.tagName.toLowerCase()){l("a",r.documentElement).orphan();var d=r.documentElement.innerText;d=d.replace(/>\s+</g,"><"),e.text=a.trim(d)}else e.data=r;else e.text=r.getElementsByTagName("textarea")[0].value;n(e)}else e.data=r}catch(e){t=e}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function p(e){this._callNext()}c.global[f]||(c.global[f]=function(){var e=b._currentDfd;if(e){var t=e.response.options,o=u.byId(t.form)||e._tmpForm;if(o){for(var r=e._contentToClean,n=0;n<r.length;n++)for(var a=r[n],i=0;i<o.childNodes.length;i++){var l=o.childNodes[i];if(l.name===a){s.destroy(l);break}}e._originalAction&&o.setAttribute("action",e._originalAction),e._originalMethod&&(o.setAttribute("method",e._originalMethod),o.method=e._originalMethod),e._originalTarget&&(o.setAttribute("target",e._originalTarget),o.target=e._originalTarget)}e._tmpForm&&(s.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0}else b._fireNextRequest()});var v={method:"POST"};function b(e,t,n){var a=r.parseArgs(e,r.deepCreate(v,t),!0);if(e=a.url,"GET"!==(t=a.options).method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");b._frame||(b._frame=b.create(b._iframeName,f+"();"));var i=r.deferred(a,null,h,_,g,p);return i._callNext=function(){this._calledNext||(this._calledNext=!0,b._currentDfd=null,b._fireNextRequest())},i._legacy=n,b._dfdQueue.push(i),b._fireNextRequest(),o(i),n?i:i.promise}return b.create=function(e,o,r){if(c.global[e])return c.global[e];if(c.global.frames[e])return c.global.frames[e];r||(d("config-useXDomain")&&!d("config-dojoBlankHtmlUrl")&&console.warn("dojo/request/iframe: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set dojoConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),r=d("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html"));var n=s.place('<iframe id="'+e+'" name="'+e+'" src="'+r+'" onload="'+o+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',c.body());return c.global[e]=n,n},b.doc=function(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var o=c.doc.getElementsByTagName("iframe");if(e.document&&o[t].contentWindow&&o[t].contentWindow.document)return o[t].contentWindow.document;if(c.doc.frames[t]&&c.doc.frames[t].document)return c.doc.frames[t].document}return null},b.setSrc=function(e,t,o){var r=c.global.frames[e.name];r.contentWindow&&(r=r.contentWindow);try{o?r.location.replace(t):r.location=t}catch(e){console.log("dojo/request/iframe.setSrc: ",e)}},b._iframeName=m+"_IoIframe",b._notifyStart=function(){},b._dfdQueue=[],b._currentDfd=null,b._fireNextRequest=function(){var e;try{if(b._currentDfd||!b._dfdQueue.length)return;do{e=b._currentDfd=b._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&b._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(b._currentDfd=null);var t,o=e.response,n=o.options,l=e._contentToClean=[],d=u.byId(n.form),f=r.notify,h=n.data||null;if(e._legacy||"POST"!==n.method||d?"GET"===n.method&&d&&o.url.indexOf("?")>-1&&(t=o.url.slice(o.url.indexOf("?")+1),h=a.mixin(i.queryToObject(t),h)):d=e._tmpForm=s.create("form",{name:m+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},c.body()),d){if(!e._legacy){var _=d;do{_=_.parentNode}while(_&&_!==c.doc.documentElement);_||(d.style.position="absolute",d.style.left="-1000px",d.style.top="-1000px",c.body().appendChild(d)),d.name||(d.name=m+"_form")}if(h){var g=function(e,t){s.create("input",{type:"hidden",name:e,value:t},d),l.push(e)};for(var p in h){var v=h[p];if(a.isArray(v)&&v.length>1)for(var y=0;y<v.length;y++)g(p,v[y]);else d[p]?d[p].value=v:g(p,v)}}var x=d.getAttributeNode("action"),N=d.getAttributeNode("method"),T=d.getAttributeNode("target");o.url&&(e._originalAction=x?x.value:null,x?x.value=o.url:d.setAttribute("action",o.url)),e._legacy?N&&N.value||(N?N.value=n.method:d.setAttribute("method",n.method)):(e._originalMethod=N?N.value:null,N?N.value=n.method:d.setAttribute("method",n.method)),e._originalTarget=T?T.value:null,T?T.value=b._iframeName:d.setAttribute("target",b._iframeName),d.target=b._iframeName,f&&f.emit("send",o,e.promise.cancel),b._notifyStart(o),d.submit()}else{var j="";o.options.data&&"string"!=typeof(j=o.options.data)&&(j=i.objectToQuery(j));var w=o.url+(o.url.indexOf("?")>-1?"&":"?")+j;f&&f.emit("send",o,e.promise.cancel),b._notifyStart(o),b.setSrc(b._frame,w,!0)}}catch(t){e.reject(t)}},r.addCommonMethods(b,["GET","POST"]),b});
//# sourceMappingURL=../sourcemaps/request/iframe.js.map
