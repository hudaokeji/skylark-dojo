/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom"],function(module,require,e,t,o,r,n,a,i,l,d,u){var s=module.id.replace(/[\/\.\-]/g,"_"),c=s+"_onload";function m(e){return!this.isFulfilled()}function f(e){return!!this._finished}function h(e,t){if(!t)try{var n=e.options,i=p.doc(p._frame),l=n.handleAs;if("html"!==l){if("xml"===l)if("html"===i.documentElement.tagName.toLowerCase()){a("a",i.documentElement).orphan();var d=i.documentElement.innerText;d=d.replace(/>\s+</g,"><"),e.text=r.trim(d)}else e.data=i;else e.text=i.getElementsByTagName("textarea")[0].value;o(e)}else e.data=i}catch(e){t=e}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function _(e){this._callNext()}u.global[c]||(u.global[c]=function(){var e=p._currentDfd;if(e){var t=e.response.options,o=l.byId(t.form)||e._tmpForm;if(o){for(var r=e._contentToClean,n=0;n<r.length;n++)for(var a=r[n],i=0;i<o.childNodes.length;i++){var u=o.childNodes[i];if(u.name===a){d.destroy(u);break}}e._originalAction&&o.setAttribute("action",e._originalAction),e._originalMethod&&(o.setAttribute("method",e._originalMethod),o.method=e._originalMethod),e._originalTarget&&(o.setAttribute("target",e._originalTarget),o.target=e._originalTarget)}e._tmpForm&&(d.destroy(e._tmpForm),delete e._tmpForm),e._finished=!0}else p._fireNextRequest()});var g={method:"POST"};function p(o,r,n){var a=t.parseArgs(o,t.deepCreate(g,r),!0);if(o=a.url,"GET"!==(r=a.options).method&&"POST"!==r.method)throw new Error(r.method+" not supported by dojo/request/iframe");p._frame||(p._frame=p.create(p._iframeName,c+"();"));var i=t.deferred(a,null,m,f,h,_);return i._callNext=function(){this._calledNext||(this._calledNext=!0,p._currentDfd=null,p._fireNextRequest())},i._legacy=n,p._dfdQueue.push(i),p._fireNextRequest(),e(i),n?i:i.promise}return p.create=function(e,t,o){if(u.global[e])return u.global[e];if(u.global.frames[e])return u.global.frames[e];o||(i("config-useXDomain")&&!i("config-dojoBlankHtmlUrl")&&console.warn("dojo/request/iframe: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set dojoConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),o=i("config-dojoBlankHtmlUrl")||require.toUrl("dojo/resources/blank.html"));var r=d.place('<iframe id="'+e+'" name="'+e+'" src="'+o+'" onload="'+t+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',u.body());return u.global[e]=r,r},p.doc=function(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var o=u.doc.getElementsByTagName("iframe");if(e.document&&o[t].contentWindow&&o[t].contentWindow.document)return o[t].contentWindow.document;if(u.doc.frames[t]&&u.doc.frames[t].document)return u.doc.frames[t].document}return null},p.setSrc=function(e,t,o){var r=u.global.frames[e.name];r.contentWindow&&(r=r.contentWindow);try{o?r.location.replace(t):r.location=t}catch(e){console.log("dojo/request/iframe.setSrc: ",e)}},p._iframeName=s+"_IoIframe",p._notifyStart=function(){},p._dfdQueue=[],p._currentDfd=null,p._fireNextRequest=function(){var e;try{if(p._currentDfd||!p._dfdQueue.length)return;do{e=p._currentDfd=p._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&p._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled())return void(p._currentDfd=null);var o,a=e.response,i=a.options,c=e._contentToClean=[],m=l.byId(i.form),f=t.notify,h=i.data||null;if(e._legacy||"POST"!==i.method||m?"GET"===i.method&&m&&a.url.indexOf("?")>-1&&(o=a.url.slice(a.url.indexOf("?")+1),h=r.mixin(n.queryToObject(o),h)):m=e._tmpForm=d.create("form",{name:s+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},u.body()),m){if(!e._legacy){var _=m;do{_=_.parentNode}while(_&&_!==u.doc.documentElement);_||(m.style.position="absolute",m.style.left="-1000px",m.style.top="-1000px",u.body().appendChild(m)),m.name||(m.name=s+"_form")}if(h){var g=function(e,t){d.create("input",{type:"hidden",name:e,value:t},m),c.push(e)};for(var v in h){var b=h[v];if(r.isArray(b)&&b.length>1)for(var y=0;y<b.length;y++)g(v,b[y]);else m[v]?m[v].value=b:g(v,b)}}var x=m.getAttributeNode("action"),N=m.getAttributeNode("method"),T=m.getAttributeNode("target");a.url&&(e._originalAction=x?x.value:null,x?x.value=a.url:m.setAttribute("action",a.url)),e._legacy?N&&N.value||(N?N.value=i.method:m.setAttribute("method",i.method)):(e._originalMethod=N?N.value:null,N?N.value=i.method:m.setAttribute("method",i.method)),e._originalTarget=T?T.value:null,T?T.value=p._iframeName:m.setAttribute("target",p._iframeName),m.target=p._iframeName,f&&f.emit("send",a,e.promise.cancel),p._notifyStart(a),m.submit()}else{var j="";a.options.data&&"string"!=typeof(j=a.options.data)&&(j=n.objectToQuery(j));var w=a.url+(a.url.indexOf("?")>-1?"&":"?")+j;f&&f.emit("send",a,e.promise.cancel),p._notifyStart(a),p.setSrc(p._frame,w,!0)}}catch(t){e.reject(t)}},t.addCommonMethods(p,["GET","POST"]),p});
//# sourceMappingURL=../sourcemaps/request/iframe.js.map
