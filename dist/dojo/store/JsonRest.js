/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["../_base/xhr","../_base/lang","../json","../_base/declare","./util/QueryResults"],function(e,t,r,n,i){return n("dojo.store.JsonRest",null,{constructor:function(e){this.headers={},n.safeMixin(this,e)},headers:{},target:"",idProperty:"id",ascendingPrefix:"+",descendingPrefix:"-",_getTarget:function(e){var t=this.target;return void 0!==e&&("/"==t.charAt(t.length-1)?t+=e:t+="/"+e),t},get:function(r,n){n=n||{};var i=t.mixin({Accept:this.accepts},this.headers,n.headers||n);return e("GET",{url:this._getTarget(r),handleAs:"json",headers:i})},accepts:"application/javascript, application/json",getIdentity:function(e){return e[this.idProperty]},put:function(n,i){var a="id"in(i=i||{})?i.id:this.getIdentity(n);return e(void 0!==a&&!i.incremental?"PUT":"POST",{url:this._getTarget(a),postData:r.stringify(n),handleAs:"json",headers:t.mixin({"Content-Type":"application/json",Accept:this.accepts,"If-Match":!0===i.overwrite?"*":null,"If-None-Match":!1===i.overwrite?"*":null},this.headers,i.headers)})},add:function(e,t){return(t=t||{}).overwrite=!1,this.put(e,t)},remove:function(r,n){return n=n||{},e("DELETE",{url:this._getTarget(r),headers:t.mixin({},this.headers,n.headers)})},query:function(r,n){n=n||{};var a=t.mixin({Accept:this.accepts},this.headers,n.headers),s=this.target.indexOf("?")>-1;if(r&&"object"==typeof r&&(r=(r=e.objectToQuery(r))?(s?"&":"?")+r:""),(n.start>=0||n.count>=0)&&(a["X-Range"]="items="+(n.start||"0")+"-"+("count"in n&&n.count!=1/0?n.count+(n.start||0)-1:""),this.rangeParam?(r+=(r||s?"&":"?")+this.rangeParam+"="+a["X-Range"],s=!0):a.Range=a["X-Range"]),n&&n.sort){var o=this.sortParam;r+=(r||s?"&":"?")+(o?o+"=":"sort(");for(var h=0;h<n.sort.length;h++){var c=n.sort[h];r+=(h>0?",":"")+(c.descending?this.descendingPrefix:this.ascendingPrefix)+encodeURIComponent(c.attribute)}o||(r+=")")}var d=e("GET",{url:this.target+(r||""),handleAs:"json",headers:a});return d.total=d.then(function(){var e=d.ioArgs.xhr.getResponseHeader("Content-Range");return e||(e=d.ioArgs.xhr.getResponseHeader("X-Content-Range")),e&&(e=e.match(/\/(.*)/))&&+e[1]}),i(d)}})});
//# sourceMappingURL=../sourcemaps/store/JsonRest.js.map
