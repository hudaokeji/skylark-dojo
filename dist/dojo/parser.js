/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){function myEval(text){return eval("("+text+")")}new Date("X");var extendCnt=0;function getNameMap(e){var t=e._nameCaseMap,r=e.prototype;if(!t||t._extendCnt<extendCnt){for(var n in t=e._nameCaseMap={},r)"_"!==n.charAt(0)&&(t[n.toLowerCase()]=n);t._extendCnt=extendCnt}return t}aspect.after(dlang,"extend",function(){extendCnt++},!0);var _ctorMap={};function getCtor(e,t){var r=e.join();if(!_ctorMap[r]){for(var n=[],a=0,o=e.length;a<o;a++){var i=e[a];n[n.length]=_ctorMap[i]=_ctorMap[i]||dlang.getObject(i)||~i.indexOf("/")&&(t?t(i):require(i))}var s=n.shift();_ctorMap[r]=n.length?s.createSubclass?s.createSubclass(n):s.extend.apply(s,n):s}return _ctorMap[r]}var parser={_clearCache:function(){extendCnt++,_ctorMap={}},_functionFromScript:function(e,t){var r="",n="",a=e.getAttribute(t+"args")||e.getAttribute("args"),o=e.getAttribute("with"),i=(a||"").split(/\s*,\s*/);return o&&o.length&&darray.forEach(o.split(/\s*,\s*/),function(e){r+="with("+e+"){",n+="}"}),new Function(i,r+e.innerHTML+n)},instantiate:function(e,t,r){t=t||{};var n=((r=r||{}).scope||dojo._scopeName)+"Type",a="data-"+(r.scope||dojo._scopeName)+"-",o=a+"type",i=a+"mixins",s=[];return darray.forEach(e,function(e){var r=n in t?t[n]:e.getAttribute(o)||e.getAttribute(n);if(r){var a=e.getAttribute(i),c=a?[r].concat(a.split(/\s*,\s*/)):[r];s.push({node:e,types:c})}}),this._instantiate(s,t,r)},_instantiate:function(e,t,r,n){var a=darray.map(e,function(e){var n=e.ctor||getCtor(e.types,r.contextRequire);if(!n)throw new Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(n,e.node,t,r,e.scripts,e.inherited)},this);function o(e){return t._started||r.noStart||darray.forEach(e,function(e){"function"!=typeof e.startup||e._started||e.startup()}),e}return n?all(a).then(o):o(a)},construct:function(e,t,r,n,a,o){var i,s=e&&e.prototype,c={};if((n=n||{}).defaults&&dlang.mixin(c,n.defaults),o&&dlang.mixin(c,o),has("dom-attributes-explicit"))i=t.attributes;else if(has("dom-attributes-specified-flag"))i=darray.filter(t.attributes,function(e){return e.specified});else{var d=(/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");i=darray.map(d.split(/\s+/),function(e){var r=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==r?t.getAttribute(r):t.getAttributeNode(r).value}})}var u=n.scope||dojo._scopeName,p="data-"+u+"-",l={};"dojo"!==u&&(l[p+"props"]="data-dojo-props",l[p+"type"]="data-dojo-type",l[p+"mixins"]="data-dojo-mixins",l[u+"type"]="dojoType",l[p+"id"]="data-dojo-id");for(var f,h,g,v=0,b=[];f=i[v++];){var y=f.name,m=y.toLowerCase(),j=f.value;switch(l[m]||m){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":g=j;break;case"data-dojo-id":case"jsid":h=j;break;case"data-dojo-attach-point":case"dojoattachpoint":c.dojoAttachPoint=j;break;case"data-dojo-attach-event":case"dojoattachevent":c.dojoAttachEvent=j;break;case"class":c.class=t.className;break;case"style":c.style=t.style&&t.style.cssText;break;default:if(!(y in s))y=getNameMap(e)[m]||y;if(y in s)switch(typeof s[y]){case"string":c[y]=j;break;case"number":c[y]=j.length?Number(j):NaN;break;case"boolean":c[y]="false"!=j.toLowerCase();break;case"function":""===j||-1!=j.search(/[^\w\.]+/i)?c[y]=new Function(j):c[y]=dlang.getObject(j,!1)||new Function(j),b.push(y);break;default:var x=s[y];c[y]=x&&"length"in x?j?j.split(/\s*,\s*/):[]:x instanceof Date?""==j?new Date(""):"now"==j?new Date:dates.fromISOString(j):x instanceof _Url?dojo.baseUrl+j:myEval(j)}else c[y]=j}}for(var _=0;_<b.length;_++){var w=b[_].toLowerCase();t.removeAttribute(w),t[w]=null}if(g)try{g=myEval.call(n.propsThis,"{"+g+"}"),dlang.mixin(c,g)}catch(e){throw new Error(e.toString()+" in data-dojo-props='"+g+"'")}dlang.mixin(c,r),a||(a=e&&(e._noScript||s._noScript)?[]:query("> script[type^='dojo/']",t));var A=[],C=[],N=[],q=[];if(a)for(v=0;v<a.length;v++){var S=a[v];t.removeChild(S);var k=S.getAttribute(p+"event")||S.getAttribute("event"),M=S.getAttribute(p+"prop"),D=S.getAttribute(p+"method"),E=S.getAttribute(p+"advice"),L=S.getAttribute("type"),T=this._functionFromScript(S,p);k?"dojo/connect"==L?A.push({method:k,func:T}):"dojo/on"==L?q.push({event:k,func:T}):c[k]=T:"dojo/aspect"==L?A.push({method:D,advice:E,func:T}):"dojo/watch"==L?N.push({prop:M,func:T}):C.push(T)}var O=e.markupFactory||s.markupFactory,F=O?O(c,t,e):new e(c,t);function R(e){for(h&&dlang.setObject(h,e),v=0;v<A.length;v++)aspect[A[v].advice||"after"](e,A[v].method,dlang.hitch(e,A[v].func),!0);for(v=0;v<C.length;v++)C[v].call(e);for(v=0;v<N.length;v++)e.watch(N[v].prop,N[v].func);for(v=0;v<q.length;v++)don(e,q[v].event,q[v].func);return e}return F.then?F.then(R):R(F)},scan:function(e,t){var r=[],n=[],a={},o=(t.scope||dojo._scopeName)+"Type",i="data-"+(t.scope||dojo._scopeName)+"-",s=i+"type",c=i+"textdir",d=i+"mixins",u=e.firstChild,p=t.inherited;if(!p){function l(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&l(e.parentNode,t)}for(var f in p={dir:l(e,"dir"),lang:l(e,"lang"),textDir:l(e,c)})p[f]||delete p[f]}var h,g,v={inherited:p};function b(e){if(!e.inherited){e.inherited={};var t=e.node,r=b(e.parent),n={dir:t.getAttribute("dir")||r.dir,lang:t.getAttribute("lang")||r.lang,textDir:t.getAttribute(c)||r.textDir};for(var a in n)n[a]&&(e.inherited[a]=n[a])}return e.inherited}for(;;)if(u)if(1==u.nodeType)if(h&&"script"==u.nodeName.toLowerCase())(y=u.getAttribute("type"))&&/^dojo\/\w/i.test(y)&&h.push(u),u=u.nextSibling;else if(g)u=u.nextSibling;else{var y=u.getAttribute(s)||u.getAttribute(o),m=u.firstChild;if(y||m&&(3!=m.nodeType||m.nextSibling)){var j,x=null;if(y){var _=u.getAttribute(d),w=_?[y].concat(_.split(/\s*,\s*/)):[y];try{x=getCtor(w,t.contextRequire)}catch(e){}x||darray.forEach(w,function(e){~e.indexOf("/")&&!a[e]&&(a[e]=!0,n[n.length]=e)});var A=x&&!x.prototype._noScript?[]:null;(j={types:w,ctor:x,parent:v,node:u,scripts:A}).inherited=b(j),r.push(j)}else j={node:u,scripts:h,parent:v};h=A,g=u.stopParser||x&&x.prototype.stopParser&&!t.template,v=j,u=m}else u=u.nextSibling}else u=u.nextSibling;else{if(!v||!v.node)break;u=v.node.nextSibling,g=!1,h=(v=v.parent).scripts}var C=new Deferred;n.length?(has("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+n.join(", ")),(t.contextRequire||require)(n,function(){C.resolve(darray.filter(r,function(e){if(!e.ctor)try{e.ctor=getCtor(e.types,t.contextRequire)}catch(e){}for(var r=e.parent;r&&!r.types;)r=r.parent;var n=e.ctor&&e.ctor.prototype;return e.instantiateChildren=!(n&&n.stopParser&&!t.template),e.instantiate=!r||r.instantiate&&r.instantiateChildren,e.instantiate}))})):C.resolve(r);return C.promise},_require:function(e,t){var r=myEval("{"+e.innerHTML+"}"),n=[],a=[],o=new Deferred,i=t&&t.contextRequire||require;for(var s in r)n.push(s),a.push(r[s]);return i(a,function(){for(var e=0;e<n.length;e++)dlang.setObject(n[e],arguments[e]);o.resolve(arguments)}),o.promise},_scanAmd:function(e,t){var r=new Deferred,n=r.promise;r.resolve(!0);var a=this;return query("script[type='dojo/require']",e).forEach(function(e){n=n.then(function(){return a._require(e,t)}),e.parentNode.removeChild(e)}),n},parse:function(e,t){var r;!t&&e&&e.rootNode?r=(t=e).rootNode:!e||!dlang.isObject(e)||"nodeType"in e?r=e:t=e,r=r?dom.byId(r):dwindow.body();var n=(t=t||{}).template?{template:!0}:{},a=[],o=this,i=this._scanAmd(r,t).then(function(){return o.scan(r,t)}).then(function(e){return o._instantiate(e,n,t,!0)}).then(function(e){return a=a.concat(e)}).otherwise(function(e){throw console.error("dojo/parser::parse() error",e),e});return dlang.mixin(a,i),a}};return has("extend-dojo")&&(dojo.parser=parser),config.parseOnLoad&&ready(100,parser,"parse"),parser});
//# sourceMappingURL=sourcemaps/parser.js.map
