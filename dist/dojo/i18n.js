/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./has!host-browser?./_base/xhr","./json","module"],function(n,e,o,r,i,t,a,l,s){o.add("dojo-preload-i18n-Api",1),o.add("dojo-v1x-i18n-Api",1);var c=n.i18n={},u=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,f={},d=function(e,o,r){return r=r?r.toLowerCase():n.locale,e=e.replace(/\./g,"/"),o=o.replace(/\./g,"/"),/root/i.test(r)?e+"/nls/"+o:e+"/nls/"+r+"/"+o},p=n.getL10nName=function(n,e,o){return s.id+"!"+d(n,e,o)},v=function(e,a,s){if(o("dojo-preload-i18n-Api")){var c=e.split("*"),d="preload"==c[1];if(d&&(f[e]||(f[e]=1,y(c[2],l.parse(c[3]),1,a)),s(1)),d||j(e,a,s))return}var p=u.exec(e),v=p[1]+"/",h=p[5]||p[4],_=v+h,g=p[5]&&p[4],x=g||n.locale||"",m=_+"/"+x,L=g?[x]:function(n){var e=i.extraLocale||[];return(e=t.isArray(e)?e:[e]).push(n),e}(x),A=L.length,z=function(){--A||s(t.delegate(f[m]))};r.forEach(L,function(n){var e=_+"/"+n;o("dojo-preload-i18n-Api")&&b(e),f[e]?z():function(n,e,o,r,i,a){n([e],function(l){var s=t.clone(l.root||l.ROOT),c=function(n,e,o,r){for(var i=[o+r],t=e.split("-"),a="",l=0;l<t.length;l++)a+=(a?"-":"")+t[l],n&&!n[a]||(i.push(o+a+"/"+r),i.specificity=a);return i}(!l._v1x&&l,i,o,r);n(c,function(){for(var n=1;n<c.length;n++)s=t.mixin(t.clone(s),arguments[n]);f[e+"/"+i]=s,s.$locale=c.specificity,a()})})}(a,_,v,h,n,z)})};if(o("dojo-unit-tests"))var h=c.unitTests=[];if(o("dojo-preload-i18n-Api")||o("dojo-v1x-i18n-Api"))var _=c.normalizeLocale=function(e){var o=e?e.toLowerCase():n.locale;return"root"==o?"ROOT":o},g=function(n,r){return!o("dojo-sync-loader")||!o("dojo-v1x-i18n-Api")||r.isXdUrl(e.toUrl(n+".js"))},x=0,m=[],y=c._preloadLocalizations=function(o,i,a,l){function s(n,e){for(var o=n.split("-");o.length;){if(e(o.join("-")))return;o.pop()}e("ROOT")}function c(){x++}function u(){for(--x;!x&&m.length;)v.apply(null,m.shift())}function d(n,e,o,r){return r.toAbsMid(n+e+"/"+o)}function p(n){s(n=_(n),function(p){if(r.indexOf(i,p)>=0){var v=o.replace(/\./g,"/")+"_"+p;return c(),function(n,e){g(n,l)||a?l([n],e):z([n],e,l)}(v,function(o){for(var r in o){var i,a,v=o[r],h=r.match(/(.+)\/([^\/]+)$/);if(h){var _;if(i=h[2],a=h[1]+"/",v._localized=v._localized||{},"ROOT"===p){var g=_=v._localized;delete v._localized,g.root=v,f[e.toAbsMid(r)]=g}else _=v._localized,f[d(a,i,p,e)]=v;if(p!==n){function x(o,r,i,a){var p=[],v=[];s(n,function(n){a[n]&&(p.push(e.toAbsMid(o+n+"/"+r)),v.push(d(o,r,n,e)))}),p.length?(c(),l(p,function(){for(var a=0;a<p.length;a++)i=t.mixin(t.clone(i),arguments[a]),f[v[a]]=i;f[d(o,r,n,e)]=t.clone(i),u()})):f[d(o,r,n,e)]=i}x(a,i,v,_)}}}u()}),!0}return!1})}l=l||e,p(),r.forEach(n.config.extraLocale,p)},j=function(n,e,o){return x&&m.push([n,e,o]),x},b=function(){};if(o("dojo-v1x-i18n-Api")){var L={},A=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"),z=function(n,e,o){var i=[];r.forEach(n,function(n){var e=o.toUrl(n+".js");function r(o){var r=A(o,b,n,L);r===L?i.push(f[e]=L.result):(r instanceof Error&&(console.error("failed to evaluate i18n bundle; url="+e,r),r={}),i.push(f[e]=/nls\/[^\/]+\/[^\/]+$/.test(e)?r:{root:r,_v1x:1}))}if(f[e])i.push(f[e]);else{var t=o.syncLoadNls(n);if(t)i.push(t);else if(a)a.get({url:e,sync:!0,load:r,error:function(){i.push(f[e]={})}});else try{o.getText(e,!0,r)}catch(n){i.push(f[e]={})}}}),e&&e.apply(null,i)};b=function(e){for(var o,r=e.split("/"),i=n.global[r[0]],t=1;i&&t<r.length-1;i=i[r[t++]]);return i&&((o=i[r[t]])||(o=i[r[t].replace(/-/g,"_")]),o&&(f[e]=o)),o},c.getLocalization=function(n,o,r){var i,t=d(n,o,r);return v(t,g(t,e)?e:function(n,o){z(n,o,e)},function(n){i=n}),i},o("dojo-unit-tests")&&h.push(function(n){n.register("tests.i18n.unit",function(n){var e;e=A("{prop:1}",b,"nonsense",L),n.is({prop:1},e),n.is(void 0,e[1]),e=A("({prop:1})",b,"nonsense",L),n.is({prop:1},e),n.is(void 0,e[1]),e=A("{'prop-x':1}",b,"nonsense",L),n.is({"prop-x":1},e),n.is(void 0,e[1]),e=A("({'prop-x':1})",b,"nonsense",L),n.is({"prop-x":1},e),n.is(void 0,e[1]),e=A("define({'prop-x':1})",b,"nonsense",L),n.is(L,e),n.is({"prop-x":1},L.result),e=A("define('some/module', {'prop-x':1})",b,"nonsense",L),n.is(L,e),n.is({"prop-x":1},L.result),e=A("this is total nonsense and should throw an error",b,"nonsense",L),n.is(e instanceof Error,!0)})})}return t.mixin(c,{dynamic:!0,normalize:function(n,e){return/^\./.test(n)?e(n):n},load:v,cache:f,getL10nName:p})});
//# sourceMappingURL=sourcemaps/i18n.js.map
