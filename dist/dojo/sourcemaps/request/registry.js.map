{"version":3,"sources":["request/registry.js"],"names":["define","require","array","fallbackProvider","util","providers","request","url","options","matcher","matchers","slice","i","call","apply","arguments","register","provider","first","match","test","createMatcher","remove","idx","indexOf","splice","load","id","parentRequire","loaded","config","fallback","addCommonMethods"],"mappings":";;;;;;;AAAAA,QACC,UACA,iBACA,qBACA,UACE,SAASC,QAASC,EAAOC,EAAkBC,GAC7C,IAAIC,KAEJ,SAASC,EAAQC,EAAKC,GAKrB,IAJA,IAECC,EAFGC,EAAWL,EAAUM,MAAM,GAC9BC,EAAI,EAGCH,EAAQC,EAASE,MACtB,GAAGH,EAAQF,EAAKC,GACf,OAAOC,EAAQH,QAAQO,KAAK,KAAMN,EAAKC,GAIzC,OAAOL,EAAiBW,MAAM,KAAMC,WAgErC,OA5BAT,EAAQU,SAAW,SAAST,EAAKU,EAAUC,GAC1C,IAAIT,EAlCL,SAAuBU,EAAOF,GAC7B,IAAIR,EA6BJ,OA3BGQ,GAGDR,EAFEU,EAAMC,KAEE,SAASb,GAClB,OAAOY,EAAMC,KAAKb,IAEXY,EAAML,OAASK,EAAMN,KACnB,WACT,OAAOM,EAAML,MAAM,KAAMC,YAGhB,SAASR,GAClB,OAAOA,IAAQY,IAITb,QAAUW,GAIlBR,EAAU,WACT,OAAO,IAGAH,QAAUa,EAGZV,EAIOY,CAAcd,EAAKU,GAGjC,OAFAZ,EAAWa,EAAQ,UAAY,QAAST,IAGvCa,OAAQ,WACP,IAAIC,IACCA,EAAMrB,EAAMsB,QAAQnB,EAAWI,KACnCJ,EAAUoB,OAAOF,EAAK,MAM1BjB,EAAQoB,KAAO,SAASC,EAAIC,EAAeC,EAAQC,GAC/CH,EAEF1B,SAAS0B,GAAK,SAASI,GACtB5B,EAAmB4B,EACnBF,EAAOvB,KAGRuB,EAAOvB,IAITF,EAAK4B,iBAAiB1B,GAEfA","file":"../../request/registry.js","sourcesContent":["define([\r\n\t'require',\r\n\t'../_base/array',\r\n\t'./default!platform',\r\n\t'./util'\r\n], function(require, array, fallbackProvider, util){\r\n\tvar providers = [];\r\n\r\n\tfunction request(url, options){\r\n\t\tvar matchers = providers.slice(0),\r\n\t\t\ti = 0,\r\n\t\t\tmatcher;\r\n\r\n\t\twhile(matcher=matchers[i++]){\r\n\t\t\tif(matcher(url, options)){\r\n\t\t\t\treturn matcher.request.call(null, url, options);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn fallbackProvider.apply(null, arguments);\r\n\t}\r\n\r\n\tfunction createMatcher(match, provider){\r\n\t\tvar matcher;\r\n\r\n\t\tif(provider){\r\n\t\t\tif(match.test){\r\n\t\t\t\t// RegExp\r\n\t\t\t\tmatcher = function(url){\r\n\t\t\t\t\treturn match.test(url);\r\n\t\t\t\t};\r\n\t\t\t}else if(match.apply && match.call){\r\n\t\t\t\tmatcher = function(){\r\n\t\t\t\t\treturn match.apply(null, arguments);\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\tmatcher = function(url){\r\n\t\t\t\t\treturn url === match;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tmatcher.request = provider;\r\n\t\t}else{\r\n\t\t\t// If only one argument was passed, assume it is a provider function\r\n\t\t\t// to apply unconditionally to all URLs\r\n\t\t\tmatcher = function(){\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\r\n\t\t\tmatcher.request = match;\r\n\t\t}\r\n\r\n\t\treturn matcher;\r\n\t}\r\n\r\n\trequest.register = function(url, provider, first){\r\n\t\tvar matcher = createMatcher(url, provider);\r\n\t\tproviders[(first ? 'unshift' : 'push')](matcher);\r\n\r\n\t\treturn {\r\n\t\t\tremove: function(){\r\n\t\t\t\tvar idx;\r\n\t\t\t\tif(~(idx = array.indexOf(providers, matcher))){\r\n\t\t\t\t\tproviders.splice(idx, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\trequest.load = function(id, parentRequire, loaded, config){\r\n\t\tif(id){\r\n\t\t\t// if there's an id, load and set the fallback provider\r\n\t\t\trequire([id], function(fallback){\r\n\t\t\t\tfallbackProvider = fallback;\r\n\t\t\t\tloaded(request);\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tloaded(request);\r\n\t\t}\r\n\t};\r\n\r\n\tutil.addCommonMethods(request);\r\n\r\n\treturn request;\r\n});\r\n"]}