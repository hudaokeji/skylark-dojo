{"version":3,"sources":["touch.js"],"names":["define","dojo","aspect","dom","domClass","lang","on","has","mouse","domReady","win","clicksInited","clickTracker","clickTarget","clickX","clickY","clickDx","clickDy","clickTime","lastTouch","hoveredNode","ios4","hasPointer","pointer","type","down","move","up","cancel","over","out","charAt","toUpperCase","slice","hasTouch","useTarget","dualEvent","mouseType","touchType","pointerType","node","listener","handle1","evt","call","this","Date","getTime","handle2","remove","doClicks","e","moveType","endType","markedNode","undefined","dojoClick","parentNode","marked","target","disabled","preventDefault","changedTouches","pageX","global","pageXOffset","clientX","pageY","pageYOffset","clientY","x","y","updateClickTracker","isDescendant","doc","elementFromPoint","Math","abs","stopNativeEvents","addEventListener","_dojo_click","tagName","contains","stopPropagation","stopImmediatePropagation","byId","getAttribute","src","clickEvt","document","createEvent","initMouseEvent","view","detail","screenX","screenY","ctrlKey","altKey","shiftKey","metaKey","setTimeout","emit","copyEventProps","props","delegate","bubbles","touches","targetTouches","body","oldNode","relatedTarget","newNode","touch","press","release","leave","enter","_eventHandler"],"mappings":"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","file":"../touch.js","sourcesContent":["define([\"./_base/kernel\", \"./aspect\", \"./dom\", \"./dom-class\", \"./_base/lang\", \"./on\", \"./has\", \"./mouse\", \"./domReady\", \"./_base/window\"],\r\nfunction(dojo, aspect, dom, domClass, lang, on, has, mouse, domReady, win){\r\n\r\n\t// module:\r\n\t//\t\tdojo/touch\r\n\r\n\tvar ios4 = has(\"ios\") < 5;\r\n\r\n\t// Detect if platform supports Pointer Events, and if so, the names of the events (pointerdown vs. MSPointerDown).\r\n\tvar hasPointer = has(\"pointer-events\") || has(\"MSPointer\"),\r\n\t\tpointer = (function () {\r\n\t\t\tvar pointer = {};\r\n\t\t\tfor (var type in { down: 1, move: 1, up: 1, cancel: 1, over: 1, out: 1 }) {\r\n\t\t\t\tpointer[type] = has(\"MSPointer\") ?\r\n\t\t\t\t\t\"MSPointer\" + type.charAt(0).toUpperCase() + type.slice(1) :\r\n\t\t\t\t\t\"pointer\" + type;\r\n\t\t\t}\r\n\t\t\treturn pointer;\r\n\t\t})();\r\n\r\n\t// Detect if platform supports the webkit touchstart/touchend/... events\r\n\tvar hasTouch = has(\"touch-events\");\r\n\r\n\t// Click generation variables\r\n\tvar clicksInited, clickTracker, useTarget = false, clickTarget, clickX, clickY, clickDx, clickDy, clickTime;\r\n\r\n\t// Time of most recent touchstart, touchmove, or touchend event\r\n\tvar lastTouch;\r\n\r\n\tfunction dualEvent(mouseType, touchType, pointerType){\r\n\t\t// Returns synthetic event that listens for both the specified mouse event and specified touch event.\r\n\t\t// But ignore fake mouse events that were generated due to the user touching the screen.\r\n\t\tif(hasPointer && pointerType){\r\n\t\t\t// IE10+: MSPointer* events are designed to handle both mouse and touch in a uniform way,\r\n\t\t\t// so just use that regardless of hasTouch.\r\n\t\t\treturn function(node, listener){\r\n\t\t\t\treturn on(node, pointerType, listener);\r\n\t\t\t}\r\n\t\t}else if(hasTouch){\r\n\t\t\treturn function(node, listener){\r\n\t\t\t\tvar handle1 = on(node, touchType, function(evt){\r\n\t\t\t\t\t\tlistener.call(this, evt);\r\n\r\n\t\t\t\t\t\t// On slow mobile browsers (see https://bugs.dojotoolkit.org/ticket/17634),\r\n\t\t\t\t\t\t// a handler for a touch event may take >1s to run.  That time shouldn't\r\n\t\t\t\t\t\t// be included in the calculation for lastTouch.\r\n\t\t\t\t\t\tlastTouch = (new Date()).getTime();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\thandle2 = on(node, mouseType, function(evt){\r\n\t\t\t\t\t\tif(!lastTouch || (new Date()).getTime() > lastTouch + 1000){\r\n\t\t\t\t\t\t\tlistener.call(this, evt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tremove: function(){\r\n\t\t\t\t\t\thandle1.remove();\r\n\t\t\t\t\t\thandle2.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t}else{\r\n\t\t\t// Avoid creating listeners for touch events on performance sensitive older browsers like IE6\r\n\t\t\treturn function(node, listener){\r\n\t\t\t\treturn on(node, mouseType, listener);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction marked(/*DOMNode*/ node){\r\n\t\t// Search for node ancestor has been marked with the dojoClick property to indicate special processing.\r\n\t\t// Returns marked ancestor.\r\n\t\tdo{\r\n\t\t\tif(node.dojoClick !== undefined){ return node; }\r\n\t\t}while(node = node.parentNode);\r\n\t}\r\n\t\r\n\tfunction doClicks(e, moveType, endType){\r\n\t\t// summary:\r\n\t\t//\t\tSetup touch listeners to generate synthetic clicks immediately (rather than waiting for the browser\r\n\t\t//\t\tto generate clicks after the double-tap delay) and consistently (regardless of whether event.preventDefault()\r\n\t\t//\t\twas called in an event listener. Synthetic clicks are generated only if a node or one of its ancestors has\r\n\t\t//\t\tits dojoClick property set to truthy. If a node receives synthetic clicks because one of its ancestors has its\r\n\t\t//      dojoClick property set to truthy, you can disable synthetic clicks on this node by setting its own dojoClick property\r\n\t\t//      to falsy.\r\n\t\t\r\n\t\tvar markedNode = marked(e.target);\r\n\t\tclickTracker  = !e.target.disabled && markedNode && markedNode.dojoClick; // click threshold = true, number, x/y object, or \"useTarget\"\r\n\t\tif(clickTracker){\r\n\t\t\tuseTarget = (clickTracker == \"useTarget\");\r\n\t\t\tclickTarget = (useTarget?markedNode:e.target);\r\n\t\t\tif(useTarget){\r\n\t\t\t\t// We expect a click, so prevent any other \r\n\t\t\t\t// default action on \"touchpress\"\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t\tclickX = e.changedTouches ? e.changedTouches[0].pageX - win.global.pageXOffset : e.clientX;\r\n\t\t\tclickY = e.changedTouches ? e.changedTouches[0].pageY - win.global.pageYOffset : e.clientY;\r\n\t\t\tclickDx = (typeof clickTracker == \"object\" ? clickTracker.x : (typeof clickTracker == \"number\" ? clickTracker : 0)) || 4;\r\n\t\t\tclickDy = (typeof clickTracker == \"object\" ? clickTracker.y : (typeof clickTracker == \"number\" ? clickTracker : 0)) || 4;\r\n\r\n\t\t\t// add move/end handlers only the first time a node with dojoClick is seen,\r\n\t\t\t// so we don't add too much overhead when dojoClick is never set.\r\n\t\t\tif(!clicksInited){\r\n\t\t\t\tclicksInited = true;\r\n\r\n\t\t\t\tfunction updateClickTracker(e){\r\n\t\t\t\t\tif(useTarget){\r\n\t\t\t\t\t\tclickTracker = dom.isDescendant(\r\n\t\t\t\t\t\t\twin.doc.elementFromPoint(\r\n\t\t\t\t\t\t\t\t(e.changedTouches ? e.changedTouches[0].pageX - win.global.pageXOffset : e.clientX),\r\n\t\t\t\t\t\t\t\t(e.changedTouches ? e.changedTouches[0].pageY - win.global.pageYOffset : e.clientY)),\r\n\t\t\t\t\t\t\tclickTarget);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tclickTracker = clickTracker &&\r\n\t\t\t\t\t\t\t(e.changedTouches ? e.changedTouches[0].target : e.target) == clickTarget &&\r\n\t\t\t\t\t\t\tMath.abs((e.changedTouches ? e.changedTouches[0].pageX - win.global.pageXOffset : e.clientX) - clickX) <= clickDx &&\r\n\t\t\t\t\t\t\tMath.abs((e.changedTouches ? e.changedTouches[0].pageY - win.global.pageYOffset : e.clientY) - clickY) <= clickDy;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twin.doc.addEventListener(moveType, function(e){\r\n\t\t\t\t\tupdateClickTracker(e);\r\n\t\t\t\t\tif(useTarget){\r\n\t\t\t\t\t\t// prevent native scroll event and ensure touchend is\r\n\t\t\t\t\t\t// fire after touch moves between press and release.\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, true);\r\n\r\n\t\t\t\twin.doc.addEventListener(endType, function(e){\r\n\t\t\t\t\tupdateClickTracker(e);\r\n\t\t\t\t\tif(clickTracker){\r\n\t\t\t\t\t\tclickTime = (new Date()).getTime();\r\n\t\t\t\t\t\tvar target = (useTarget?clickTarget:e.target);\r\n\t\t\t\t\t\tif(target.tagName === \"LABEL\"){\r\n\t\t\t\t\t\t\t// when clicking on a label, forward click to its associated input if any\r\n\t\t\t\t\t\t\ttarget = dom.byId(target.getAttribute(\"for\")) || target;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//some attributes can be on the Touch object, not on the Event:\r\n\t\t\t\t\t\t//http://www.w3.org/TR/touch-events/#touch-interface\r\n\t\t\t\t\t\tvar src = (e.changedTouches) ? e.changedTouches[0] : e;\r\n\t\t\t\t\t\t//create the synthetic event.\r\n\t\t\t\t\t\t//http://www.w3.org/TR/DOM-Level-3-Events/#widl-MouseEvent-initMouseEvent\r\n\t\t\t\t\t\tvar clickEvt = document.createEvent(\"MouseEvents\");\r\n\t\t\t\t\t\tclickEvt._dojo_click = true;\r\n\t\t\t\t\t\tclickEvt.initMouseEvent(\"click\",\r\n\t\t\t\t\t\t\ttrue, //bubbles\r\n\t\t\t\t\t\t\ttrue, //cancelable\r\n\t\t\t\t\t\t\te.view,\r\n\t\t\t\t\t\t\te.detail,\r\n\t\t\t\t\t\t\tsrc.screenX,\r\n\t\t\t\t\t\t\tsrc.screenY,\r\n\t\t\t\t\t\t\tsrc.clientX,\r\n\t\t\t\t\t\t\tsrc.clientY,\r\n\t\t\t\t\t\t\te.ctrlKey,\r\n\t\t\t\t\t\t\te.altKey,\r\n\t\t\t\t\t\t\te.shiftKey,\r\n\t\t\t\t\t\t\te.metaKey,\r\n\t\t\t\t\t\t\t0, //button\r\n\t\t\t\t\t\t\tnull //related target\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\ton.emit(target, \"click\", clickEvt);\r\n\r\n\t\t\t\t\t\t\t// refresh clickTime in case app-defined click handler took a long time to run\r\n\t\t\t\t\t\t\tclickTime = (new Date()).getTime();\r\n\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, true);\r\n\r\n\t\t\t\tfunction stopNativeEvents(type){\r\n\t\t\t\t\twin.doc.addEventListener(type, function(e){\r\n\t\t\t\t\t\t// Stop native events when we emitted our own click event.  Note that the native click may occur\r\n\t\t\t\t\t\t// on a different node than the synthetic click event was generated on.  For example,\r\n\t\t\t\t\t\t// click on a menu item, causing the menu to disappear, and then (~300ms later) the browser\r\n\t\t\t\t\t\t// sends a click event to the node that was *underneath* the menu.  So stop all native events\r\n\t\t\t\t\t\t// sent shortly after ours, similar to what is done in dualEvent.\r\n\t\t\t\t\t\t// The INPUT.dijitOffScreen test is for offscreen inputs used in dijit/form/Button, on which\r\n\t\t\t\t\t\t// we call click() explicitly, we don't want to stop this event.\r\n\t\t\t\t\t\t\tif(!e._dojo_click &&\r\n\t\t\t\t\t\t\t\t(new Date()).getTime() <= clickTime + 1000 &&\r\n\t\t\t\t\t\t\t\t!(e.target.tagName == \"INPUT\" && domClass.contains(e.target, \"dijitOffScreen\"))){\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\te.stopImmediatePropagation && e.stopImmediatePropagation();\r\n\t\t\t\t\t\t\tif(type == \"click\" && (e.target.tagName != \"INPUT\" || e.target.type == \"radio\" || e.target.type == \"checkbox\")\r\n\t\t\t\t\t\t\t\t&& e.target.tagName != \"TEXTAREA\" && e.target.tagName != \"AUDIO\" && e.target.tagName != \"VIDEO\"){\r\n\t\t\t\t\t\t\t\t // preventDefault() breaks textual <input>s on android, keyboard doesn't popup,\r\n\t\t\t\t\t\t\t\t // but it is still needed for checkboxes and radio buttons, otherwise in some cases\r\n\t\t\t\t\t\t\t\t // the checked state becomes inconsistent with the widget's state\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstopNativeEvents(\"click\");\r\n\r\n\t\t\t\t// We also stop mousedown/up since these would be sent well after with our \"fast\" click (300ms),\r\n\t\t\t\t// which can confuse some dijit widgets.\r\n\t\t\t\tstopNativeEvents(\"mousedown\");\r\n\t\t\t\tstopNativeEvents(\"mouseup\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar hoveredNode;\r\n\r\n\tif(hasPointer){\r\n\t\t // MSPointer (IE10+) already has support for over and out, so we just need to init click support\r\n\t\tdomReady(function(){\r\n\t\t\twin.doc.addEventListener(pointer.down, function(evt){\r\n\t\t\t\tdoClicks(evt, pointer.move, pointer.up);\r\n\t\t\t}, true);\r\n\t\t});\r\n\t}else if(hasTouch){\r\n\t\tdomReady(function(){\r\n\t\t\t// Keep track of currently hovered node\r\n\t\t\thoveredNode = win.body();\t// currently hovered node\r\n\r\n\t\t\twin.doc.addEventListener(\"touchstart\", function(evt){\r\n\t\t\t\t\tlastTouch = (new Date()).getTime();\r\n\r\n\t\t\t\t// Precede touchstart event with touch.over event.  DnD depends on this.\r\n\t\t\t\t// Use addEventListener(cb, true) to run cb before any touchstart handlers on node run,\r\n\t\t\t\t// and to ensure this code runs even if the listener on the node does event.stop().\r\n\t\t\t\tvar oldNode = hoveredNode;\r\n\t\t\t\thoveredNode = evt.target;\r\n\t\t\t\ton.emit(oldNode, \"dojotouchout\", {\r\n\t\t\t\t\trelatedTarget: hoveredNode,\r\n\t\t\t\t\tbubbles: true\r\n\t\t\t\t});\r\n\t\t\t\ton.emit(hoveredNode, \"dojotouchover\", {\r\n\t\t\t\t\trelatedTarget: oldNode,\r\n\t\t\t\t\tbubbles: true\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdoClicks(evt, \"touchmove\", \"touchend\"); // init click generation\r\n\t\t\t}, true);\r\n\r\n\t\t\tfunction copyEventProps(evt){\r\n\t\t\t\t// Make copy of event object and also set bubbles:true.  Used when calling on.emit().\r\n\t\t\t\tvar props = lang.delegate(evt, {\r\n\t\t\t\t\tbubbles: true\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(has(\"ios\") >= 6){\r\n\t\t\t\t\t// On iOS6 \"touches\" became a non-enumerable property, which\r\n\t\t\t\t\t// is not hit by for...in.  Ditto for the other properties below.\r\n\t\t\t\t\tprops.touches = evt.touches;\r\n\t\t\t\t\tprops.altKey = evt.altKey;\r\n\t\t\t\t\tprops.changedTouches = evt.changedTouches;\r\n\t\t\t\t\tprops.ctrlKey = evt.ctrlKey;\r\n\t\t\t\t\tprops.metaKey = evt.metaKey;\r\n\t\t\t\t\tprops.shiftKey = evt.shiftKey;\r\n\t\t\t\t\tprops.targetTouches = evt.targetTouches;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn props;\r\n\t\t\t}\r\n\r\n\t\t\ton(win.doc, \"touchmove\", function(evt){\r\n\t\t\t\tlastTouch = (new Date()).getTime();\r\n\r\n\t\t\t\tvar newNode = win.doc.elementFromPoint(\r\n\t\t\t\t\tevt.pageX - (ios4 ? 0 : win.global.pageXOffset), // iOS 4 expects page coords\r\n\t\t\t\t\tevt.pageY - (ios4 ? 0 : win.global.pageYOffset)\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif(newNode){\r\n\t\t\t\t\t// Fire synthetic touchover and touchout events on nodes since the browser won't do it natively.\r\n\t\t\t\t\tif(hoveredNode !== newNode){\r\n\t\t\t\t\t\t// touch out on the old node\r\n\t\t\t\t\t\ton.emit(hoveredNode, \"dojotouchout\", {\r\n\t\t\t\t\t\t\trelatedTarget: newNode,\r\n\t\t\t\t\t\t\tbubbles: true\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// touchover on the new node\r\n\t\t\t\t\t\ton.emit(newNode, \"dojotouchover\", {\r\n\t\t\t\t\t\t\trelatedTarget: hoveredNode,\r\n\t\t\t\t\t\t\tbubbles: true\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\thoveredNode = newNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Unlike a listener on \"touchmove\", on(node, \"dojotouchmove\", listener) fires when the finger\r\n\t\t\t\t\t// drags over the specified node, regardless of which node the touch started on.\r\n\t\t\t\t\tif(!on.emit(newNode, \"dojotouchmove\", copyEventProps(evt))){\r\n\t\t\t\t\t\t// emit returns false when synthetic event \"dojotouchmove\" is cancelled, so we prevent the\r\n\t\t\t\t\t\t// default behavior of the underlying native event \"touchmove\".\r\n\t\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Fire a dojotouchend event on the node where the finger was before it was removed from the screen.\r\n\t\t\t// This is different than the native touchend, which fires on the node where the drag started.\r\n\t\t\ton(win.doc, \"touchend\", function(evt){\r\n\t\t\t\t\tlastTouch = (new Date()).getTime();\r\n\t\t\t\tvar node = win.doc.elementFromPoint(\r\n\t\t\t\t\tevt.pageX - (ios4 ? 0 : win.global.pageXOffset), // iOS 4 expects page coords\r\n\t\t\t\t\tevt.pageY - (ios4 ? 0 : win.global.pageYOffset)\r\n\t\t\t\t) || win.body(); // if out of the screen\r\n\r\n\t\t\t\ton.emit(node, \"dojotouchend\", copyEventProps(evt));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t//device neutral events - touch.press|move|release|cancel/over/out\r\n\tvar touch = {\r\n\t\tpress: dualEvent(\"mousedown\", \"touchstart\", pointer.down),\r\n\t\tmove: dualEvent(\"mousemove\", \"dojotouchmove\", pointer.move),\r\n\t\trelease: dualEvent(\"mouseup\", \"dojotouchend\", pointer.up),\r\n\t\tcancel: dualEvent(mouse.leave, \"touchcancel\", hasPointer ? pointer.cancel : null),\r\n\t\tover: dualEvent(\"mouseover\", \"dojotouchover\", pointer.over),\r\n\t\tout: dualEvent(\"mouseout\", \"dojotouchout\", pointer.out),\r\n\t\tenter: mouse._eventHandler(dualEvent(\"mouseover\",\"dojotouchover\", pointer.over)),\r\n\t\tleave: mouse._eventHandler(dualEvent(\"mouseout\", \"dojotouchout\", pointer.out))\r\n\t};\r\n\r\n\t/*=====\r\n\ttouch = {\r\n\t\t// summary:\r\n\t\t//\t\tThis module provides unified touch event handlers by exporting\r\n\t\t//\t\tpress, move, release and cancel which can also run well on desktop.\r\n\t\t//\t\tBased on http://dvcs.w3.org/hg/webevents/raw-file/tip/touchevents.html\r\n\t\t//      Also, if the dojoClick property is set to truthy on a DOM node, dojo/touch generates\r\n\t\t//      click events immediately for this node and its descendants (except for descendants that\r\n\t\t//      have a dojoClick property set to falsy), to avoid the delay before native browser click events,\r\n\t\t//      and regardless of whether evt.preventDefault() was called in a touch.press event listener.\r\n\t\t//\r\n\t\t// example:\r\n\t\t//\t\tUsed with dojo/on\r\n\t\t//\t\t|\tdefine([\"dojo/on\", \"dojo/touch\"], function(on, touch){\r\n\t\t//\t\t|\t\ton(node, touch.press, function(e){});\r\n\t\t//\t\t|\t\ton(node, touch.move, function(e){});\r\n\t\t//\t\t|\t\ton(node, touch.release, function(e){});\r\n\t\t//\t\t|\t\ton(node, touch.cancel, function(e){});\r\n\t\t// example:\r\n\t\t//\t\tUsed with touch.* directly\r\n\t\t//\t\t|\ttouch.press(node, function(e){});\r\n\t\t//\t\t|\ttouch.move(node, function(e){});\r\n\t\t//\t\t|\ttouch.release(node, function(e){});\r\n\t\t//\t\t|\ttouch.cancel(node, function(e){});\r\n\t\t// example:\r\n\t\t//\t\tHave dojo/touch generate clicks without delay, with a default move threshold of 4 pixels\r\n\t\t//\t\t|\tnode.dojoClick = true;\r\n\t\t// example:\r\n\t\t//\t\tHave dojo/touch generate clicks without delay, with a move threshold of 10 pixels horizontally and vertically\r\n\t\t//\t\t|\tnode.dojoClick = 10;\r\n\t\t// example:\r\n\t\t//\t\tHave dojo/touch generate clicks without delay, with a move threshold of 50 pixels horizontally and 10 pixels vertically\r\n\t\t//\t\t|\tnode.dojoClick = {x:50, y:5};\r\n\t\t// example:\r\n\t\t//\t\tDisable clicks without delay generated by dojo/touch on a node that has an ancestor with property dojoClick set to truthy\r\n\t\t//\t\t|  node.dojoClick = false;\r\n\r\n\t\tpress: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to 'touchstart'|'mousedown' for the given node\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\tmove: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener that fires when the mouse cursor or a finger is dragged over the given node.\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\trelease: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to releasing the mouse button while the cursor is over the given node\r\n\t\t\t//\t\t(i.e. \"mouseup\") or for removing the finger from the screen while touching the given node.\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\tcancel: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to 'touchcancel'|'mouseleave' for the given node\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\tover: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to 'mouseover' or touch equivalent for the given node\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\tout: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to 'mouseout' or touch equivalent for the given node\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\tenter: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to mouse.enter or touch equivalent for the given node\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t},\r\n\t\tleave: function(node, listener){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegister a listener to mouse.leave or touch equivalent for the given node\r\n\t\t\t// node: Dom\r\n\t\t\t//\t\tTarget node to listen to\r\n\t\t\t// listener: Function\r\n\t\t\t//\t\tCallback function\r\n\t\t\t// returns:\r\n\t\t\t//\t\tA handle which will be used to remove the listener by handle.remove()\r\n\t\t}\r\n\t};\r\n\t=====*/\r\n\r\n\thas(\"extend-dojo\") && (dojo.touch = touch);\r\n\r\n\treturn touch;\r\n});\r\n"]}