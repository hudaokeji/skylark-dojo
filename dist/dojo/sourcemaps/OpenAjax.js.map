{"version":3,"sources":["OpenAjax.js"],"names":["window","OpenAjax","libs","ooh","h","this","hub","implementer","implVersion","specVersion","implExtraData","libraries","registerLibrary","prefix","nsURL","version","extra","namespaceURI","extraData","publish","unregisterLibrary","_subscriptions","c","s","_cleanup","_subIndex","_pubDepth","subscribe","name","callback","scope","subscriberData","filter","handle","sub","cb","fcb","data","sid","hdl","path","split","_subscribe","message","_publish","length","i","unsubscribe","pop","_unsubscribe","tree","index","token","push","msg","node","callbacks","max","sc","d","call","childNode","x","splice","reinit","lib"],"mappings":";;;;;;;AAqBIA,OAAiB,WACpBC,SAAW,IAAI,WAMd,IAAIC,KACAC,EAAM,oBAENC,KACJC,KAAKC,IAAMF,EACXA,EAAEG,YAAc,sBAChBH,EAAEI,YAAc,MAChBJ,EAAEK,YAAc,MAChBL,EAAEM,iBACFN,EAAEO,UAAYT,EAEdE,EAAEQ,gBAAkB,SAASC,EAAQC,EAAOC,EAASC,GACpDd,EAAKW,IACJA,OAAQA,EACRI,aAAcH,EACdC,QAASA,EACTG,UAAWF,GAEZX,KAAKc,QAAQhB,EAAI,kBAAmBD,EAAKW,KAE1CT,EAAEgB,kBAAoB,SAASP,GAC9BR,KAAKc,QAAQhB,EAAI,oBAAqBD,EAAKW,WACpCX,EAAKW,IAGbT,EAAEiB,gBAAmBC,KAAMC,MAC3BnB,EAAEoB,YACFpB,EAAEqB,UAAY,EACdrB,EAAEsB,UAAY,EAEdtB,EAAEuB,UAAY,SAASC,EAAMC,EAAUC,EAAOC,EAAgBC,GACzDF,IACHA,EAAQ9B,QAET,IAAIiC,EAASL,EAAO,IAAMvB,KAAKoB,UAC3BS,GAAQJ,MAAOA,EAAOK,GAAIN,EAAUO,IAAKJ,EAAQK,KAAMN,EAAgBO,IAAKjC,KAAKoB,YAAac,IAAKN,GACnGO,EAAOZ,EAAKa,MAAM,KAEtB,OADCpC,KAAKqC,WAAWrC,KAAKgB,eAAgBmB,EAAM,EAAGN,GACxCD,GAGR7B,EAAEe,QAAU,SAASS,EAAMe,GAC1B,IAAIH,EAAOZ,EAAKa,MAAM,KAItB,GAHApC,KAAKqB,YACLrB,KAAKuC,SAASvC,KAAKgB,eAAgBmB,EAAM,EAAGZ,EAAMe,GAClDtC,KAAKqB,YACDrB,KAAKmB,SAASqB,OAAS,GAAyB,GAAlBxC,KAAKqB,UAAgB,CACtD,IAAI,IAAIoB,EAAI,EAAGA,EAAIzC,KAAKmB,SAASqB,OAAQC,IACxCzC,KAAK0C,YAAY1C,KAAKmB,SAASsB,GAAGP,YAE5BlC,KAAa,SACpBA,KAAKmB,cAIPpB,EAAE2C,YAAc,SAASb,GACxB,IAAIM,EAAON,EAAIO,MAAM,KACjBH,EAAME,EAAKQ,MACf3C,KAAK4C,aAAa5C,KAAKgB,eAAgBmB,EAAM,EAAGF,IAGjDlC,EAAEsC,WAAa,SAASQ,EAAMV,EAAMW,EAAOjB,GAC1C,IAAIkB,EAAQZ,EAAKW,GACdA,GAASX,EAAKK,OAChBK,EAAK3B,EAAE8B,KAAKnB,SAEQ,IAAVgB,EAAK5B,IACd4B,EAAK5B,WAEqB,IAAjB4B,EAAK5B,EAAE8B,KAChBF,EAAK5B,EAAE8B,IAAW9B,KAAOC,OAE1BlB,KAAKqC,WAAWQ,EAAK5B,EAAE8B,GAAQZ,EAAMW,EAAQ,EAAGjB,KAIlD9B,EAAEwC,SAAW,SAASM,EAAMV,EAAMW,EAAOvB,EAAM0B,GAE7C,IAAIC,EADL,QAAkB,IAARL,IAENC,GAASX,EAAKK,OAChBU,EAAOL,GAEP7C,KAAKuC,SAASM,EAAK5B,EAAEkB,EAAKW,IAASX,EAAMW,EAAQ,EAAGvB,EAAM0B,GAC1DjD,KAAKuC,SAASM,EAAK5B,EAAE,KAAMkB,EAAMW,EAAQ,EAAGvB,EAAM0B,GAClDC,EAAOL,EAAK5B,EAAE,YAEG,IAARiC,GAGT,IAFA,IAAIC,EAAYD,EAAKhC,EACjBkC,EAAMD,EAAUX,OACZC,EAAI,EAAGA,EAAIW,EAAKX,IACvB,GAAGU,EAAUV,GAAGX,GAAG,CAClB,IAAIuB,EAAKF,EAAUV,GAAGhB,MAClBK,EAAKqB,EAAUV,GAAGX,GAClBC,EAAMoB,EAAUV,GAAGV,IACnBuB,EAAIH,EAAUV,GAAGT,KACL,iBAANF,IAETA,EAAKuB,EAAGvB,IAEQ,iBAAPC,IAETA,EAAMsB,EAAGtB,IAELA,IACHA,EAAIwB,KAAKF,EAAI9B,EAAM0B,EAAKK,IACzBxB,EAAGyB,KAAKF,EAAI9B,EAAM0B,EAAKK,KAQ7BvD,EAAE6C,aAAe,SAASC,EAAMV,EAAMW,EAAOb,GAC5C,QAAkB,IAARY,EAAoB,CAC7B,GAAGC,EAAQX,EAAKK,OAAO,CACtB,IAAIgB,EAAYX,EAAK5B,EAAEkB,EAAKW,IAE5B,GADA9C,KAAK4C,aAAaY,EAAWrB,EAAMW,EAAQ,EAAGb,GACrB,GAAtBuB,EAAUtC,EAAEsB,OAAY,CAC1B,IAAI,IAAIiB,KAAKD,EAAUvC,EACtB,cACM4B,EAAK5B,EAAEkB,EAAKW,IAEpB,OAKA,IAFA,IAAIK,EAAYN,EAAK3B,EACjBkC,EAAMD,EAAUX,OACZC,EAAI,EAAGA,EAAIW,EAAKX,IACvB,GAAGR,GAAOkB,EAAUV,GAAGR,IAOtB,YANGjC,KAAKqB,UAAY,GACnB8B,EAAUV,GAAGX,GAAK,KAClB9B,KAAKmB,SAAS6B,KAAKG,EAAUV,KAG7BU,EAAUO,OAAOjB,EAAG,MAU1B1C,EAAE4D,OAAS,WACV,IAAK,IAAIC,KAAOhE,SAASK,IAAIK,iBACrBV,SAASK,IAAIK,UAAUsD,GAE/BhE,SAASK,IAAIM,gBAAgB,WAAY,0BAA2B,iBAE7DX,SAASoB,eAChBpB,SAASoB,gBAAkBC,KAAKC,aACzBtB,SAASuB,SAChBvB,SAASuB,YACTvB,SAASwB,UAAY,EACrBxB,SAASyB,UAAY,IAKvBzB,SAASK,IAAIM,gBAAgB,WAAY,0BAA2B","file":"../OpenAjax.js","sourcesContent":["/*******************************************************************************\r\n * OpenAjax.js\r\n *\r\n * Reference implementation of the OpenAjax Hub, as specified by OpenAjax Alliance.\r\n * Specification is under development at:\r\n *\r\n *   http://www.openajax.org/member/wiki/OpenAjax_Hub_Specification\r\n *\r\n * Copyright 2006-2007 OpenAjax Alliance\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\r\n * use this file except in compliance with the License. You may obtain a copy\r\n * of the License at http://www.apache.org/licenses/LICENSE-2.0 . Unless\r\n * required by applicable law or agreed to in writing, software distributed\r\n * under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the\r\n * specific language governing permissions and limitations under the License.\r\n *\r\n ******************************************************************************/\r\n\r\n// prevent re-definition of the OpenAjax object\r\nif(!window[\"OpenAjax\"]){\r\n\tOpenAjax = new function(){\r\n\t\t// summary:\r\n\t\t//\t\tthe OpenAjax hub\r\n\t\t// description:\r\n\t\t//\t\tsee http://www.openajax.org/member/wiki/OpenAjax_Hub_Specification\r\n\r\n\t\tvar libs = {};\r\n\t\tvar ooh = \"org.openajax.hub.\";\r\n\r\n\t\tvar h = {};\r\n\t\tthis.hub = h;\r\n\t\th.implementer = \"http://openajax.org\";\r\n\t\th.implVersion = \"0.6\";\r\n\t\th.specVersion = \"0.6\";\r\n\t\th.implExtraData = {};\r\n\t\th.libraries = libs;\r\n\r\n\t\th.registerLibrary = function(prefix, nsURL, version, extra){\r\n\t\t\tlibs[prefix] = {\r\n\t\t\t\tprefix: prefix,\r\n\t\t\t\tnamespaceURI: nsURL,\r\n\t\t\t\tversion: version,\r\n\t\t\t\textraData: extra\r\n\t\t\t};\r\n\t\t\tthis.publish(ooh+\"registerLibrary\", libs[prefix]);\r\n\t\t};\r\n\t\th.unregisterLibrary = function(prefix){\r\n\t\t\tthis.publish(ooh+\"unregisterLibrary\", libs[prefix]);\r\n\t\t\tdelete libs[prefix];\r\n\t\t};\r\n\r\n\t\th._subscriptions = { c:{}, s:[] };\r\n\t\th._cleanup = [];\r\n\t\th._subIndex = 0;\r\n\t\th._pubDepth = 0;\r\n\r\n\t\th.subscribe = function(name, callback, scope, subscriberData, filter){\r\n\t\t\tif(!scope){\r\n\t\t\t\tscope = window;\r\n\t\t\t}\r\n\t\t\tvar handle = name + \".\" + this._subIndex;\r\n\t\t\tvar sub = { scope: scope, cb: callback, fcb: filter, data: subscriberData, sid: this._subIndex++, hdl: handle };\r\n\t\t\tvar path = name.split(\".\");\r\n\t \t\tthis._subscribe(this._subscriptions, path, 0, sub);\r\n\t\t\treturn handle;\r\n\t\t};\r\n\r\n\t\th.publish = function(name, message){\r\n\t\t\tvar path = name.split(\".\");\r\n\t\t\tthis._pubDepth++;\r\n\t\t\tthis._publish(this._subscriptions, path, 0, name, message);\r\n\t\t\tthis._pubDepth--;\r\n\t\t\tif((this._cleanup.length > 0) && (this._pubDepth == 0)){\r\n\t\t\t\tfor(var i = 0; i < this._cleanup.length; i++){\r\n\t\t\t\t\tthis.unsubscribe(this._cleanup[i].hdl);\r\n\t\t\t\t}\r\n\t\t\t\tdelete(this._cleanup);\r\n\t\t\t\tthis._cleanup = [];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\th.unsubscribe = function(sub){\r\n\t\t\tvar path = sub.split(\".\");\r\n\t\t\tvar sid = path.pop();\r\n\t\t\tthis._unsubscribe(this._subscriptions, path, 0, sid);\r\n\t\t};\r\n\t\t\r\n\t\th._subscribe = function(tree, path, index, sub){\r\n\t\t\tvar token = path[index];\r\n\t\t\tif(index == path.length){\r\n\t\t\t\ttree.s.push(sub);\r\n\t\t\t}else{\r\n\t\t\t\tif(typeof tree.c == \"undefined\"){\r\n\t\t\t\t\ttree.c = {};\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof tree.c[token] == \"undefined\"){\r\n\t\t\t\t\ttree.c[token] = { c: {}, s: [] };\r\n\t\t\t\t}\r\n\t\t\t\tthis._subscribe(tree.c[token], path, index + 1, sub);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\th._publish = function(tree, path, index, name, msg){\r\n\t\t\tif(typeof tree != \"undefined\"){\r\n\t\t\t\tvar node;\r\n\t\t\t\tif(index == path.length){\r\n\t\t\t\t\tnode = tree;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._publish(tree.c[path[index]], path, index + 1, name, msg);\r\n\t\t\t\t\tthis._publish(tree.c[\"*\"], path, index + 1, name, msg);\r\n\t\t\t\t\tnode = tree.c[\"**\"];\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof node != \"undefined\"){\r\n\t\t\t\t\tvar callbacks = node.s;\r\n\t\t\t\t\tvar max = callbacks.length;\r\n\t\t\t\t\tfor(var i = 0; i < max; i++){\r\n\t\t\t\t\t\tif(callbacks[i].cb){\r\n\t\t\t\t\t\t\tvar sc = callbacks[i].scope;\r\n\t\t\t\t\t\t\tvar cb = callbacks[i].cb;\r\n\t\t\t\t\t\t\tvar fcb = callbacks[i].fcb;\r\n\t\t\t\t\t\t\tvar d = callbacks[i].data;\r\n\t\t\t\t\t\t\tif(typeof cb == \"string\"){\r\n\t\t\t\t\t\t\t\t// get a function object\r\n\t\t\t\t\t\t\t\tcb = sc[cb];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(typeof fcb == \"string\"){\r\n\t\t\t\t\t\t\t\t// get a function object\r\n\t\t\t\t\t\t\t\tfcb = sc[fcb];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif((!fcb) ||\r\n\t\t\t\t\t\t\t\t(fcb.call(sc, name, msg, d))){\r\n\t\t\t\t\t\t\t\tcb.call(sc, name, msg, d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\t\r\n\t\th._unsubscribe = function(tree, path, index, sid){\r\n\t\t\tif(typeof tree != \"undefined\"){\r\n\t\t\t\tif(index < path.length){\r\n\t\t\t\t\tvar childNode = tree.c[path[index]];\r\n\t\t\t\t\tthis._unsubscribe(childNode, path, index + 1, sid);\r\n\t\t\t\t\tif(childNode.s.length == 0){\r\n\t\t\t\t\t\tfor(var x in childNode.c)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\tdelete tree.c[path[index]];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tvar callbacks = tree.s;\r\n\t\t\t\t\tvar max = callbacks.length;\r\n\t\t\t\t\tfor(var i = 0; i < max; i++){\r\n\t\t\t\t\t\tif(sid == callbacks[i].sid){\r\n\t\t\t\t\t\t\tif(this._pubDepth > 0){\r\n\t\t\t\t\t\t\t\tcallbacks[i].cb = null;\r\n\t\t\t\t\t\t\t\tthis._cleanup.push(callbacks[i]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tcallbacks.splice(i, 1);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// The following function is provided for automatic testing purposes.\r\n\t\t// It is not expected to be deployed in run-time OpenAjax Hub implementations.\r\n\t\th.reinit = function(){\r\n\t\t\tfor (var lib in OpenAjax.hub.libraries){\r\n\t\t\t\tdelete OpenAjax.hub.libraries[lib];\r\n\t\t\t}\r\n\t\t\tOpenAjax.hub.registerLibrary(\"OpenAjax\", \"http://openajax.org/hub\", \"0.6\", {});\r\n\r\n\t\t\tdelete OpenAjax._subscriptions;\r\n\t\t\tOpenAjax._subscriptions = {c:{},s:[]};\r\n\t\t\tdelete OpenAjax._cleanup;\r\n\t\t\tOpenAjax._cleanup = [];\r\n\t\t\tOpenAjax._subIndex = 0;\r\n\t\t\tOpenAjax._pubDepth = 0;\r\n\t\t};\r\n\t};\r\n\r\n\t// Register the OpenAjax Hub itself as a library.\r\n\tOpenAjax.hub.registerLibrary(\"OpenAjax\", \"http://openajax.org/hub\", \"0.6\", {});\r\n\r\n}\r\n"]}