/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["./kernel","../has","require","module","../json","./lang","./array"],function(dojo,has,require,thisModule,json,lang,array){if(!has("dojo-loader"))return console.error("cannot load the Dojo v1.x loader with a foreign loader"),0;has.add("dojo-fast-sync-require",1);var makeErrorToken=function(e){return{src:thisModule.id,id:e}},slashName=function(e){return e.replace(/\./g,"/")},buildDetectRe=/\/\/>>built/,dojoRequireCallbacks=[],dojoRequireModuleStack=[],dojoRequirePlugin=function(e,require,o){dojoRequireCallbacks.push(o),array.forEach(e.split(","),function(e){var module=getModule(e,require.module);dojoRequireModuleStack.push(module),injectModule(module)}),checkDojoRequirePlugin()},checkDojoRequirePlugin=has("dojo-fast-sync-require")?function(){var module,e;for(e in modules)if(void 0===(module=modules[e]).noReqPluginCheck&&(module.noReqPluginCheck=/loadInit\!/.test(e)||/require\!/.test(e)?1:0),!module.executed&&!module.noReqPluginCheck&&module.injected==requested)return;guardCheckComplete(function(){var e=dojoRequireCallbacks;dojoRequireCallbacks=[],array.forEach(e,function(e){e(1)})})}:(traverse=function(e){touched[e.mid]=1;for(var o,module,r=e.deps||[],i=0;i<r.length;i++)if(module=r[i],!((o=touched[module.mid])||0!==o&&traverse(module)))return touched[e.mid]=0,!1;return!0},function(){var module,e;for(e in touched={},modules)(module=modules[e]).executed||module.noReqPluginCheck?touched[e]=1:(0!==module.noReqPluginCheck&&(module.noReqPluginCheck=/loadInit\!/.test(e)||/require\!/.test(e)?1:0),module.noReqPluginCheck?touched[e]=1:module.injected!==arrived&&(touched[e]=0));for(var o,r=0,i=dojoRequireModuleStack.length;r<i;r++)if(module=dojoRequireModuleStack[r],!((o=touched[module.mid])||0!==o&&traverse(module)))return;guardCheckComplete(function(){var e=dojoRequireCallbacks;dojoRequireCallbacks=[],array.forEach(e,function(e){e(1)})})}),dojoLoadInitPlugin=function(mid,require,loaded){require([mid],function(bundle){require(bundle.names,function(){for(var scopeText="",args=[],i=0;i<arguments.length;i++)scopeText+="var "+bundle.names[i]+"= arguments["+i+"]; ",args.push(arguments[i]);eval(scopeText);var callingModule=require.module,requireList=[],i18nDeps,syncLoaderApi={provide:function(e){e=slashName(e);var o=getModule(e,callingModule);o!==callingModule&&setArrived(o)},require:function(e,o){e=slashName(e),o&&(getModule(e,callingModule).result=nonmodule),requireList.push(e)},requireLocalization:function(e,o,r){i18nDeps||(i18nDeps=["dojo/i18n"]),r=(r||dojo.locale).toLowerCase(),e=slashName(e)+"/nls/"+(/root/i.test(r)?"":r+"/")+slashName(o),getModule(e,callingModule).isXd&&i18nDeps.push("dojo/i18n!"+e)},loadInit:function(e){e()}},hold={},p;try{for(p in syncLoaderApi)hold[p]=dojo[p],dojo[p]=syncLoaderApi[p];bundle.def.apply(null,args)}catch(e){signal("error",[makeErrorToken("failedDojoLoadInit"),e])}finally{for(p in syncLoaderApi)dojo[p]=hold[p]}i18nDeps&&(requireList=requireList.concat(i18nDeps)),requireList.length?dojoRequirePlugin(requireList.join(","),require,loaded):loaded()})})},extractApplication=function(e,o,r){var i,n=/\(|\)/g,a=1;for(n.lastIndex=o;(i=n.exec(e))&&(")"==i[0]?a-=1:a+=1,0!=a););if(0!=a)throw"unmatched paren around character "+n.lastIndex+" in: "+e;return[dojo.trim(e.substring(r,n.lastIndex))+";\n",n.lastIndex]},removeCommentRe=/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/gm,syncLoaderApiRe=/(^|\s)dojo\.(loadInit|require|provide|requireLocalization|requireIf|requireAfterIf|platformRequire)\s*\(/gm,amdLoaderApiRe=/(^|\s)(require|define)\s*\(/m,extractLegacyApiApplications=function(e,o){var r,i,n,a,t=[],d=[],u=[];for(o=o||e.replace(removeCommentRe,function(e){return syncLoaderApiRe.lastIndex=amdLoaderApiRe.lastIndex=0,syncLoaderApiRe.test(e)||amdLoaderApiRe.test(e)?"":e});r=syncLoaderApiRe.exec(o);)n=(i=syncLoaderApiRe.lastIndex)-r[0].length,a=extractApplication(o,i,n),"loadInit"==r[2]?t.push(a[0]):d.push(a[0]),syncLoaderApiRe.lastIndex=a[1];return(u=t.concat(d)).length||!amdLoaderApiRe.test(o)?[e.replace(/(^|\s)dojo\.loadInit\s*\(/g,"\n0 && dojo.loadInit("),u.join(""),u]:0},transformToAmd=function(module,e){var o,r,i=[],n=[];if(buildDetectRe.test(e)||!(o=extractLegacyApiApplications(e)))return 0;for(var a in r=module.mid+"-*loadInit",getModule("dojo",module).result.scopeMap)i.push(a),n.push('"'+a+'"');return"// xdomain rewrite of "+module.mid+"\ndefine('"+r+"',{\n\tnames:"+json.stringify(i)+",\n\tdef:function("+i.join(",")+"){"+o[1]+"}});\n\ndefine("+json.stringify(i.concat(["dojo/loadInit!"+r]))+", function("+i.join(",")+"){\n"+o[0]+"});"},loaderVars=require.initSyncLoader(dojoRequirePlugin,checkDojoRequirePlugin,transformToAmd),sync=loaderVars.sync,requested=loaderVars.requested,arrived=loaderVars.arrived,nonmodule=loaderVars.nonmodule,executing=loaderVars.executing,executed=loaderVars.executed,syncExecStack=loaderVars.syncExecStack,modules=loaderVars.modules,execQ=loaderVars.execQ,getModule=loaderVars.getModule,injectModule=loaderVars.injectModule,setArrived=loaderVars.setArrived,signal=loaderVars.signal,finishExec=loaderVars.finishExec,execModule=loaderVars.execModule,getLegacyMode=loaderVars.getLegacyMode,guardCheckComplete=loaderVars.guardCheckComplete,touched,traverse;return dojoRequirePlugin=loaderVars.dojoRequirePlugin,dojo.provide=function(e){var o=syncExecStack[0],module=lang.mixin(getModule(slashName(e),require.module),{executed:executing,result:lang.getObject(e,!0)});return setArrived(module),o&&(o.provides||(o.provides=[])).push(function(){module.result=lang.getObject(e),delete module.provides,module.executed!==executed&&finishExec(module)}),module.result},has.add("config-publishRequireResult",1,0,0),dojo.require=function(e,o){var r=function(e,o){var module=getModule(slashName(e),require.module);if(syncExecStack.length&&syncExecStack[0].finish)syncExecStack[0].finish.push(e);else{if(module.executed)return module.result;o&&(module.result=nonmodule);var r=getLegacyMode();if(injectModule(module),r=getLegacyMode(),module.executed!==executed&&module.injected===arrived&&loaderVars.guardCheckComplete(function(){execModule(module)}),module.executed)return module.result;r==sync?module.cjs?execQ.unshift(module):syncExecStack.length&&(syncExecStack[0].finish=[e]):execQ.push(module)}}(e,o);return has("config-publishRequireResult")&&!lang.exists(e)&&void 0!==r&&lang.setObject(e,r),r},dojo.loadInit=function(e){e()},dojo.registerModulePath=function(e,o){var r={};r[e.replace(/\./g,"/")]=o,require({paths:r})},dojo.platformRequire=function(e){for(var o,r=(e.common||[]).concat(e[dojo._name]||e.default||[]);r.length;)lang.isArray(o=r.shift())?dojo.require.apply(dojo,o):dojo.require(o)},dojo.requireIf=dojo.requireAfterIf=function(e,o,r){e&&dojo.require(o,r)},dojo.requireLocalization=function(e,o,r){require(["../i18n"],function(i){i.getLocalization(e,o,r)})},{extractLegacyApiApplications:extractLegacyApiApplications,require:dojoRequirePlugin,loadInit:dojoLoadInitPlugin}});
//# sourceMappingURL=../sourcemaps/_base/loader.js.map
