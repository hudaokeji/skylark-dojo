/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["./kernel","../Deferred","../promise/Promise","../errors/CancelError","../has","./lang","../when"],function(e,r,t,n,i,s,c){var o=function(){},d=Object.freeze||function(){},a=e.Deferred=function(e){var c,f,h,l,u,v,p,j=this.promise=new t;function b(e){if(f)throw new Error("This deferred has already been resolved");c=e,f=!0,m()}function m(){for(var e;!e&&p;){var t=p;p=p.next,(e=t.progress==o)&&(f=!1);var n=u?t.error:t.resolved;if(i("config-useDeferredInstrumentation")&&u&&r.instrumentRejected&&r.instrumentRejected(c,!!n),n)try{var d=n(c);if(d&&"function"==typeof d.then){d.then(s.hitch(t.deferred,"resolve"),s.hitch(t.deferred,"reject"),s.hitch(t.deferred,"progress"));continue}var a=e&&void 0===d;e&&!a&&(u=d instanceof Error),t.deferred[a&&u?"reject":"resolve"](a?c:d)}catch(e){t.deferred.reject(e)}else u?t.deferred.reject(c):t.deferred.resolve(c)}}this.isResolved=j.isResolved=function(){return 0==l},this.isRejected=j.isRejected=function(){return 1==l},this.isFulfilled=j.isFulfilled=function(){return l>=0},this.isCanceled=j.isCanceled=function(){return h},this.resolve=this.callback=function(e){this.fired=l=0,this.results=[e,null],b(e)},this.reject=this.errback=function(e){u=!0,this.fired=l=1,i("config-useDeferredInstrumentation")&&r.instrumentRejected&&r.instrumentRejected(e,!!p),b(e),this.results=[null,e]},this.progress=function(e){for(var r=p;r;){var t=r.progress;t&&t(e),r=r.next}},this.addCallbacks=function(e,r){return this.then(e,r,o),this},j.then=this.then=function(e,r,t){var n=t==o?this:new a(j.cancel),i={resolved:e,error:r,progress:t,deferred:n};return p?v=v.next=i:p=v=i,f&&m(),n.promise};var g=this;j.cancel=this.cancel=function(){if(!f){var r=e&&e(g);f||(r instanceof Error||(r=new n(r)),r.log=!1,g.reject(r))}h=!0},d(j)};return s.extend(a,{addCallback:function(r){return this.addCallbacks(s.hitch.apply(e,arguments))},addErrback:function(r){return this.addCallbacks(null,s.hitch.apply(e,arguments))},addBoth:function(r){var t=s.hitch.apply(e,arguments);return this.addCallbacks(t,t)},fired:-1}),a.when=e.when=c,a});
//# sourceMappingURL=../sourcemaps/_base/Deferred.js.map
