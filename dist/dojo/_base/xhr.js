/**
 * dojo - A version of dojo.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dojo/
 * @license MIT
 */
define(["./kernel","./sniff","require","../io-query","../dom","../dom-form","./Deferred","./config","./json","./lang","./array","../on","../aspect","../request/watch","../request/xhr","../request/util"],function(e,r,require,o,t,n,i,s,u,a,c,l,d,h,f,p){e._xhrObj=f._create;var y=e.config;e.objectToQuery=o.objectToQuery,e.queryToObject=o.queryToObject,e.fieldToObject=n.fieldToObject,e.formToObject=n.toObject,e.formToQuery=n.toQuery,e.formToJson=n.toJson,e._blockAsync=!1;var x=e._contentHandlers=e.contentHandlers={text:function(e){return e.responseText},json:function(e){return u.fromJson(e.responseText||null)},"json-comment-filtered":function(e){s.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}&&\nUse djConfig.useCommentedJson=true to turn off this message.");var r=e.responseText,o=r.indexOf("/*"),t=r.lastIndexOf("*/");if(-1==o||-1==t)throw new Error("JSON was not comment filtered");return u.fromJson(r.substring(o+2,t))},javascript:function(r){return e.eval(r.responseText)},xml:function(e){var o=e.responseXML;if(o&&r("dom-qsa2.1")&&!o.querySelectorAll&&r("dom-parser")&&(o=(new DOMParser).parseFromString(e.responseText,"application/xml")),r("ie")&&(!o||!o.documentElement)){var t=function(e){return"MSXML"+e+".DOMDocument"},n=["Microsoft.XMLDOM",t(6),t(4),t(3),t(2)];c.some(n,function(r){try{var t=new ActiveXObject(r);t.async=!1,t.loadXML(e.responseText),o=t}catch(e){return!1}return!0})}return o},"json-comment-optional":function(e){return e.responseText&&/^[^{\[]*\/\*/.test(e.responseText)?x["json-comment-filtered"](e):x.json(e)}};e._ioSetArgs=function(r,s,u,c){var l={args:r,url:r.url},d=null;if(r.form){var h=t.byId(r.form),f=h.getAttributeNode("action");l.url=l.url||(f?f.value:null),d=n.toObject(h)}var p=[{}];d&&p.push(d),r.content&&p.push(r.content),r.preventCache&&p.push({"dojo.preventCache":(new Date).valueOf()}),l.query=o.objectToQuery(a.mixin.apply(null,p)),l.handleAs=r.handleAs||"text";var x=new i(function(e){e.canceled=!0,s&&s(e);var r=e.ioArgs.error;return r||((r=new Error("request cancelled")).dojoType="cancel",e.ioArgs.error=r),r});x.addCallback(u);var m=r.load;m&&a.isFunction(m)&&x.addCallback(function(e){return m.call(r,e,l)});var b=r.error;b&&a.isFunction(b)&&x.addErrback(function(e){return b.call(r,e,l)});var T=r.handle;return T&&a.isFunction(T)&&x.addBoth(function(e){return T.call(r,e,l)}),x.addErrback(function(e){return c(e,x)}),y.ioPublish&&e.publish&&!1!==l.args.ioPublish&&(x.addCallbacks(function(r){return e.publish("/dojo/io/load",[x,r]),r},function(r){return e.publish("/dojo/io/error",[x,r]),r}),x.addBoth(function(r){return e.publish("/dojo/io/done",[x,r]),r})),x.ioArgs=l,x};var m=function(e){var r=x[e.ioArgs.handleAs](e.ioArgs.xhr);return void 0===r?null:r},b=function(e,r){return r.ioArgs.args.failOk||console.error(e),e},T=function(r){j<=0&&(j=0,y.ioPublish&&e.publish&&(!r||r&&!1!==r.ioArgs.args.ioPublish)&&e.publish("/dojo/io/stop"))},j=0;d.after(h,"_onAction",function(){j-=1}),d.after(h,"_onInFlight",T),e._ioCancelAll=h.cancelAll,e._ioNotifyStart=function(r){y.ioPublish&&e.publish&&!1!==r.ioArgs.args.ioPublish&&(j||e.publish("/dojo/io/start"),j+=1,e.publish("/dojo/io/send",[r]))},e._ioWatch=function(e,r,o,t){e.ioArgs.options=e.ioArgs.args;a.mixin(e,{response:e.ioArgs,isValid:function(o){return r(e)},isReady:function(r){return o(e)},handleResponse:function(r){return t(e)}}),h(e),T(e)};return e._ioAddQueryToUrl=function(e){e.query.length&&(e.url+=(-1==e.url.indexOf("?")?"?":"&")+e.query,e.query=null)},e.xhr=function(r,o,t){var n,i=e._ioSetArgs(o,function(e){n&&n.cancel()},m,b),s=i.ioArgs;"postData"in o?s.query=o.postData:"putData"in o?s.query=o.putData:"rawBody"in o?s.query=o.rawBody:(arguments.length>2&&!t||-1==="POST|PUT".indexOf(r.toUpperCase()))&&e._ioAddQueryToUrl(s);var u={method:r,handleAs:"text",timeout:o.timeout,withCredentials:o.withCredentials,ioArgs:s};void 0!==o.headers&&(u.headers=o.headers),void 0!==o.contentType&&(u.headers||(u.headers={}),u.headers["Content-Type"]=o.contentType),void 0!==s.query&&(u.data=s.query),void 0!==o.sync&&(u.sync=o.sync),e._ioNotifyStart(i);try{n=f(s.url,u,!0)}catch(e){return i.cancel(),i}return i.ioArgs.xhr=n.response.xhr,n.then(function(){i.resolve(i)}).otherwise(function(e){s.error=e,e.response&&(e.status=e.response.status,e.responseText=e.response.text,e.xhr=e.response.xhr),i.reject(e)}),i},e.xhrGet=function(r){return e.xhr("GET",r)},e.rawXhrPost=e.xhrPost=function(r){return e.xhr("POST",r,!0)},e.rawXhrPut=e.xhrPut=function(r){return e.xhr("PUT",r,!0)},e.xhrDelete=function(r){return e.xhr("DELETE",r)},e._isDocumentOk=function(e){return p.checkStatus(e.status)},e._getText=function(r){var o;return e.xhrGet({url:r,sync:!0,load:function(e){o=e}}),o},a.mixin(e.xhr,{_xhrObj:e._xhrObj,fieldToObject:n.fieldToObject,formToObject:n.toObject,objectToQuery:o.objectToQuery,formToQuery:n.toQuery,formToJson:n.toJson,queryToObject:o.queryToObject,contentHandlers:x,_ioSetArgs:e._ioSetArgs,_ioCancelAll:e._ioCancelAll,_ioNotifyStart:e._ioNotifyStart,_ioWatch:e._ioWatch,_ioAddQueryToUrl:e._ioAddQueryToUrl,_isDocumentOk:e._isDocumentOk,_getText:e._getText,get:e.xhrGet,post:e.xhrPost,put:e.xhrPut,del:e.xhrDelete}),e.xhr});
//# sourceMappingURL=../sourcemaps/_base/xhr.js.map
